@model IEnumerable<UserManagementApp.Models.User>
@{
    ViewData["Title"] = "Users Management";
    Layout = "_Layout";
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Users Management</h2>
        <form asp-controller="Account" asp-action="Logout" method="post">
            <button type="submit" class="btn btn-outline-danger">Logout</button>
        </form>
    </div>

    <div class="card shadow">
        <div class="card-body">
            <form id="userForm" method="post">
                <div class="mb-3">
                    <button type="button" class="btn btn-danger me-2" onclick="submitAction('Block')">
                        <i class="bi bi-lock-fill"></i> Block
                    </button>
                    <button type="button" class="btn btn-success me-2" onclick="submitAction('Unblock')">
                        <i class="bi bi-unlock-fill"></i> Unblock
                    </button>
                    <button type="button" class="btn btn-warning" onclick="submitAction('Delete')">
                        <i class="bi bi-trash-fill"></i> Delete
                    </button>
                </div>

                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>
                                    <input type="checkbox" id="selectAll" onclick="toggleSelectAll(this)" />
                                </th>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Registration Time</th>
                                <th>Last Login</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var user in Model)
                            {
                                <tr class="@(user.IsBlocked ? "table-danger" : "")">
                                    <td>
                                        <input type="checkbox" name="ids" value="@user.Id" class="user-checkbox" />
                                    </td>
                                    <td>@user.Id</td>
                                    <td>@user.Name</td>
                                    <td>@user.Email</td>
                                    <td>@user.RegistrationTime.ToString("yyyy-MM-dd HH:mm")</td>
                                    <td>@(user.LastLoginTime?.ToString("yyyy-MM-dd HH:mm") ?? "Never")</td>
                                    <td>
                                        @if (user.IsBlocked)
                                        {
                                            <span class="badge bg-danger">Blocked</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-success">Active</span>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function toggleSelectAll(source) {
            const checkboxes = document.querySelectorAll('.user-checkbox');
            checkboxes.forEach(checkbox => checkbox.checked = source.checked);
        }

        function submitAction(action) {
            const form = document.getElementById('userForm');
            const checkedBoxes = document.querySelectorAll('.user-checkbox:checked');
            
            if (checkedBoxes.length === 0) {
                alert('Please select at least one user');
                return;
            }

            form.action = '/Users/' + action;
            form.submit();
        }
    </script>
}